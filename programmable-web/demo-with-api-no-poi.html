<html>
  <head>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
  <style type="text/css">
    .map-marker {
      font-size: 2em;
      left: -0.5em;
      top: -1.5em;
      position: absolute;
    }
    .red { color: red; }
    .blue { color: blue; }
    .yellow { color: yellow; }
  </style>
  </head>
  <body>
    <div id="map" style="height: 600px;"></div>
    <script type="text/javascript" >
      var origin = [51.504622, -0.089905]; // This is the Location of starting point which is London School of Commerce
      var radiusMeters = 3 * 1609.34; // miles * meters per mile.

      var osmUrl="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"; // This the OSM public tile layer for the map url template.
      var osmTileLayer = L.tileLayer(osmUrl, {minZoom: 8, maxZoom: 12});

      function getMonday8Am() {
        d = new Date();
        d.setUTCHours(8, 0);

        var day = d.getDay(),
          diff = d.getDate() - day + (day == 0 ? -6:1); // adjust when day is sunday
        return new Date(d.setDate(diff));
      }

      var arrivalTime = getMonday8Am().toISOString(); // The start time sent to the API must be an ISO string
      var travelTime = 30 * 60; // Travel time is specified in seconds, in this case it is 30 minutes.
      var mode = "public_transport";

      // we use the starting coordinates to center the map.
      var map = L.map("map").addLayer(osmTileLayer).setView(origin, 12);

      // simple post request helper, could use jQuery instead.
      function postRequest(request, endpoint, callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (xhttp.readyState == 4 && xhttp.status == 200) {
            callback(xhttp.responseText);
          }
        };

        xhttp.open("POST", "http://api.traveltimeapp.com/v3/" + endpoint, true);
        xhttp.send(JSON.stringify(request));
      }

      function timeMap(origin, arrivalTime, travelTime, mode) {
        var request = {
          format: "hash",
          smooth: true,
          targets: {
            shape1: {
              coords: [51.504622, -0.089905], // This is the Location of starting point which is London School of Commerce
              arrival_time: arrivalTime,
              travel_time: travelTime,
              mode: mode
            }
          },
          shapes: {
            shape1: {simplify: false, max_points: 0}
          },
          intersections: {},
          unions: {},
          app_id: "37038da8",
          app_key: "bea255b312f538a368c8efa5abf10748",
        };

        postRequest(request, "time_map", function (response) {
          var responseJson = JSON.parse(response);
          var shape = responseJson.results.shape1.shape;

          shape.forEach(function(s) {
            var holes = s.holes;
            holes.unshift(s.shell);
            L.polygon(holes).addTo(map);
          });
        });
      }
      
      timeMap(origin, arrivalTime, travelTime, mode);
    </script>
  </body>
</html>